<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P2P聊天室 - 安全的P2P聊天和文件传输工具</title>
  <meta name="description" content="一个安全的私密聊天室应用，基于WebRTC实现点对点连接，支持创建房间、邀请链接、实时聊天和文件传输，无需中转服务器，安全高效。" />
  <meta name="keywords" content="私密聊天, 点对点聊天, 安全聊天室, WebRTC聊天, 文件传输, P2P聊天工具, 无中转聊天" />
  <script src="./xchatuser.js?v=23"></script>
  <link rel="stylesheet" href="./style.css?v=23">
</head>
<body>
  <!-- 背景装饰 -->
  <div class="background-decoration">
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
  </div>
  
  <!-- 拖拽文件提示 -->
  <div class="dragtip">
    <h1>松开发送文件</h1>
    <div class="drag-preview-area">
      <div class="drag-icon">📁</div>
      <div class="drag-text">将文件拖拽到这里<br>支持任意格式文件</div>
    </div>
  </div>

  <!-- 移动端顶部导航栏 -->
  <header class="app-header mobile-only">
    <div class="header-left">
      <div class="app-logo-mini">
        <svg viewBox="0 0 100 100" width="32" height="32">
          <defs>
                <linearGradient id="logoGradientMini" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981"/>
                  <stop offset="100%" style="stop-color:#06b6d4"/>
            </linearGradient>
          </defs>
          <circle cx="50" cy="50" r="45" fill="url(#logoGradientMini)" opacity="0.2"/>
          <path d="M25 35 L75 35 Q80 35 80 40 L80 60 Q80 65 75 65 L35 65 L25 75 L25 40 Q25 35 30 35 Z" fill="url(#logoGradientMini)"/>
          <circle cx="40" cy="50" r="3" fill="white"/>
          <circle cx="50" cy="50" r="3" fill="white"/>
          <circle cx="60" cy="50" r="3" fill="white"/>
        </svg>
      </div>
      <h1 class="app-title">P2P聊天室</h1>
    </div>
    <div class="header-right">
      <button class="header-btn toggle-users-btn" title="在线用户">
        <svg viewBox="0 0 24 24" width="22" height="22">
          <path fill="currentColor" d="M16,13C15.71,13 15.38,13 15.03,13.05C16.19,13.89 17,15 17,16.5V19H23V16.5C23,14.17 18.33,13 16,13M8,13C5.67,13 1,14.17 1,16.5V19H15V16.5C15,14.17 10.33,13 8,13M8,11A3,3 0 0,0 11,8A3,3 0 0,0 8,5A3,3 0 0,0 5,8A3,3 0 0,0 8,11M16,11A3,3 0 0,0 19,8A3,3 0 0,0 16,5A3,3 0 0,0 13,8A3,3 0 0,0 16,11Z"/>
        </svg>
        <span class="online-count" id="onlineCount">0</span>
      </button>
      <button class="header-btn theme-btn" title="切换主题">
        <svg viewBox="0 0 24 24" width="22" height="22">
          <path fill="currentColor" d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- 主聊天区域 -->
  <div class="left">
    <!-- 欢迎页面 -->
    <div class="welcome-section" id="welcomeSection">
      <div class="welcome-content">
        <div class="app-logo">
          <svg viewBox="0 0 100 100" width="80" height="80">
            <defs>
                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981"/>
                  <stop offset="100%" style="stop-color:#06b6d4"/>
              </linearGradient>
            </defs>
            <circle cx="50" cy="50" r="45" fill="url(#logoGradient)" opacity="0.2"/>
            <path d="M25 35 L75 35 Q80 35 80 40 L80 60 Q80 65 75 65 L35 65 L25 75 L25 40 Q25 35 30 35 Z" fill="url(#logoGradient)"/>
            <circle cx="40" cy="50" r="3" fill="white"/>
            <circle cx="50" cy="50" r="3" fill="white"/>
            <circle cx="60" cy="50" r="3" fill="white"/>
          </svg>
        </div>
        <h1 class="welcome-title">P2P聊天室</h1>
        <p class="welcome-subtitle">局域网文字/文件P2P传输工具</p>
        <div class="feature-cards">
          <div class="feature-card">
            <div class="feature-icon">💬</div>
            <h3>实时聊天</h3>
            <p>基于WebRTC的点对点聊天</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">📁</div>
            <h3>文件传输</h3>
            <p>支持任意格式文件快速传输</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">🔒</div>
            <h3>安全私密</h3>
            <p>无需中转服务器，数据直连</p>
          </div>
        </div>
        <div class="connection-info">
          <div class="connection-status-indicator">
            <div class="pulse-dot"></div>
            <span>等待连接...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 聊天消息区域 -->
    <div class="chat-wrapper" id="chatWrapper" style="display: none;">
    </div>

    <!-- 工具栏 -->
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="toolbar-btn nickname-btn" title="设置昵称">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M12 6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 10c2.7 0 5.8 1.29 6 2H6c.23-.72 3.31-2 6-2m0-12C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 10c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
        </button>
        <button class="toolbar-btn file-btn" title="发送文件">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
          </svg>
        </button>
        <button class="toolbar-btn emoji-btn" title="表情符号">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,17.5C14.33,17.5 16.31,16.04 17.11,14H6.89C7.69,16.04 9.67,17.5 12,17.5M8.5,11A1.5,1.5 0 0,0 10,9.5A1.5,1.5 0 0,0 8.5,8A1.5,1.5 0 0,0 7,9.5A1.5,1.5 0 0,0 8.5,11M15.5,11A1.5,1.5 0 0,0 17,9.5A1.5,1.5 0 0,0 15.5,8A1.5,1.5 0 0,0 14,9.5A1.5,1.5 0 0,0 15.5,11Z"/>
          </svg>
        </button>
      </div>
      <div class="toolbar-right">
        <button class="toolbar-btn theme-btn desktop-only" title="切换主题">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"/>
          </svg>
        </button>
        <button class="toolbar-btn settings-btn desktop-only" title="设置">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
          </svg>
        </button>
        <button class="toolbar-btn toggle-users-btn mobile-only" title="切换在线用户列表">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M16,13C15.71,13 15.38,13 15.03,13.05C16.19,13.89 17,15 17,16.5V19H23V16.5C23,14.17 18.33,13 16,13M8,13C5.67,13 1,14.17 1,16.5V19H15V16.5C15,14.17 10.33,13 8,13M8,11A3,3 0 0,0 11,8A3,3 0 0,0 8,5A3,3 0 0,0 5,8A3,3 0 0,0 8,11M16,11A3,3 0 0,0 19,8A3,3 0 0,0 16,5A3,3 0 0,0 13,8A3,3 0 0,0 16,11Z"/>
          </svg>
        </button>
        <button class="toolbar-btn send-btn" title="发送消息">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- 消息输入框 -->
    <textarea id="messageInput" class="txt-msg" onkeydown="enterTxt(event)" placeholder="输入消息...按 Enter 发送，Shift+Enter 或 Ctrl+Enter 换行"></textarea>
  </div>

  <!-- 用户列表侧边栏 -->
  <div class="right">
    <div class="sidebar-header">
      <h2 class="sidebar-title">在线用户</h2>
      <button class="sidebar-close mobile-only" onclick="toggleUsersList()">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
        </svg>
      </button>
    </div>
    <div class="network-status">
      <div class="network-quality excellent" id="networkQuality">
        <div class="quality-bars">
          <div class="quality-bar"></div>
          <div class="quality-bar"></div>
          <div class="quality-bar"></div>
          <div class="quality-bar"></div>
        </div>
        <span>网络优秀</span>
      </div>
    </div>
    <div class="users-container">
      <ul id="users">
      </ul>
    </div>
  </div>

  <!-- 移动端遮罩层 -->
  <div class="mobile-overlay"></div>

  <div class="modal" id="userSelectModal">
    <div class="modal-content">
      <h3>选择接收用户</h3>
      <div class="user-list" id="userSelectList">
      </div>
      <div class="progress-container" style="display: none;">
        <div class="progress-text">正在发送...</div>
        <div class="progress-bar">
          <div class="progress-bar-inner"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="cancelSendFile()">取消</button>
        <button onclick="confirmSendFile()">发送</button>
      </div>
    </div>
  </div>

  <div class="modal" id="nicknameModal">
    <div class="modal-content">
      <h3>设置昵称</h3>
      <div class="nickname-input-container">
        <input type="text" id="nicknameInput" maxlength="10" placeholder="请输入昵称（最多10个字符）">
      </div>
      <div class="modal-footer">
        <button onclick="closeNicknameModal()">取消</button>
        <button onclick="saveNickname()">保存</button>
      </div>
    </div>
  </div>

  <div class="modal" id="passwordModal">
    <div class="modal-content">
      <h3>请输入房间密码</h3>
      <div class="nickname-input-container">
        <input type="password" id="roomPasswordInput" placeholder="请输入密码" autocomplete="off" name="password_fake">
      </div>
      <div class="modal-footer">
        <button onclick="submitRoomPassword()">确认</button>
      </div>
    </div>
  </div>

  <div class="modal" id="emojiModal">
    <div class="modal-content emoji-modal-content">
      <h3>选择表情符号</h3>
      <div class="emoji-categories">
        <button class="emoji-category-btn active" data-category="smileys">😀</button>
        <button class="emoji-category-btn" data-category="people">👋</button>
        <button class="emoji-category-btn" data-category="nature">🌸</button>
        <button class="emoji-category-btn" data-category="food">🍎</button>
        <button class="emoji-category-btn" data-category="activities">⚽</button>
        <button class="emoji-category-btn" data-category="travel">🚗</button>
        <button class="emoji-category-btn" data-category="objects">💡</button>
        <button class="emoji-category-btn" data-category="symbols">❤️</button>
      </div>
      <div class="emoji-grid" id="emojiGrid">
        <!-- 表情符号将通过JavaScript动态加载 -->
      </div>
      <div class="modal-footer">
        <button onclick="closeEmojiModal()">关闭</button>
      </div>
    </div>
  </div>

  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <h3>设置</h3>
      <div class="settings-section">
        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="soundNotification" checked>
            <span class="checkmark"></span>
            声音通知
          </label>
          <p class="setting-description">收到新消息时播放提示音</p>
        </div>
        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="desktopNotification">
            <span class="checkmark"></span>
            桌面通知
          </label>
          <p class="setting-description">收到新消息时显示桌面通知</p>
        </div>
        <div class="setting-item">
          <label class="setting-label">
            <input type="checkbox" id="autoScroll" checked>
            <span class="checkmark"></span>
            自动滚动
          </label>
          <p class="setting-description">收到新消息时自动滚动到底部</p>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeSettingsModal()">关闭</button>
        <button onclick="saveSettings()">保存</button>
      </div>
    </div>
  </div>

  <script src="./index.js?v=22"></script>
</body>
</html>
